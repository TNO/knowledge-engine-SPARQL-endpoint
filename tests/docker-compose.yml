services:
  # This is the knowledge directory, facilitating discovery between different runtimes. It exposes its service over port 8282.
  kd:
    image: ghcr.io/tno/knowledge-engine/knowledge-directory:1.2.3

  # We create one runtime that contains the different test knowledge bases. This runtime is available via port 8280 
  kbs-runtime:
    image: ghcr.io/tno/knowledge-engine/smart-connector:1.3.1
    environment: 
      KE_RUNTIME_PORT: 8081
      KE_RUNTIME_EXPOSED_URL: http://kbs-runtime:8081
      KD_URL: http://kd:8282
      KE_REASONER_LEVEL: 4
    ports:
      - "8280:8280"

  # One KB is added to answer questions about historic events and when they occurred
  historic-events-kb:
    build: ./knowledge-network/answering_kb
    environment:
      KE_URL: http://kbs-runtime:8280/rest
      KB_ID: http://example.org/a-historic-events-knowledge-base-id
      PREFIXES: |
        {
          "ex": "http://example.org/"
        }
      GRAPH_PATTERN: |
        ?event ex:hasOccurredAt ?datetime .
      KB_DATA: |
        [
          {
            "event": "<http://example.org/FirstLandingOnTheMoon>",
            "datetime": "\"1969-07-20T20:05:00Z\"^^xsd:dateTime"
          }
        ]

  # Another KB is added to react to posts about main historic events and whom was involved
  persons-involved-kb:
    build: ./knowledge-network/react_kb
    environment:
      KE_URL: http://kbs-runtime:8280/rest
      KB_ID: http://example.org/a-persons-involved-knowledge-base-id
      PREFIXES: |
        {
          "ex": "http://example.org/"
        }
      ARGUMENT_GRAPH_PATTERN: |
        ?event a ex:MainHistoricEvent .
      RESULT_GRAPH_PATTERN: |
        ?event ex:mainPersonsInvolved ?person .
      KB_DATA: |
        [
          {
            "event": "<http://example.org/FirstLandingOnTheMoon>",
            "person": "<http://example.org/Neil_Armstrong>"
          }
        ]
