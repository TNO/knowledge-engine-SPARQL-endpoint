services:
  # This is the knowledge directory, facilitating discovery between different
  # runtimes. It exposes its service over port 8282.
  knowledge-directory:
    image: ghcr.io/tno/knowledge-engine/knowledge-directory:1.2.3

  # These services are seperate Knowledge Engine runtime, which can host
  # multiple smart connectors. Note that the REST API port is a DIFFERENT port
  # number than the ones configured below. It is still the default 8280.
  runtime-1:
    image: ghcr.io/tno/knowledge-engine/smart-connector:1.2.4
    ports:
      - "8280:8280"
    environment: 
      KE_RUNTIME_PORT: 8081 # The port that the KE uses to listen for inter-KE-runtime communication.
      KE_RUNTIME_EXPOSED_URL: http://runtime-1:8081 # The URL where the runtime is available for inter-runtime communication from the outside.
      #KD_URL: http://knowledge-directory:8282
  runtime-2:
    image: ghcr.io/tno/knowledge-engine/smart-connector:1.2.4
    environment: 
      KE_RUNTIME_PORT: 8081
      KE_RUNTIME_EXPOSED_URL: http://runtime-2:8081
      KD_URL: http://knowledge-directory:8282
  runtime-3:
    image: ghcr.io/tno/knowledge-engine/smart-connector:1.2.4
    environment: 
      KE_RUNTIME_PORT: 8081
      KE_RUNTIME_EXPOSED_URL: http://runtime-3:8081
      KD_URL: http://knowledge-directory:8282
  
  # These Knowledge Bases use the different runtimes, and exchange data with eachother.
  kb1:
    build: ./answering_kb
    environment:
      KE_URL: http://runtime-1:8280/rest
      KB_ID: http://example.org/kb1
      PREFIXES: |
        {
          "rdf": "http://www.w3.org/1999/02/22-rdf-syntax-ns#",
          "c2": "https://www.tno.nl/defense/ontology/c2/"
        }
      GRAPH_PATTERN: |
        ?att rdf:type c2:CyberAttack .
        ?att c2:hasOccurredAt ?datetime .
        ?att c2:isTargetedTowards ?struc .
      KB_DATA: |
        [
          {
            "att": "<https://www.tno.nl/defense/data/c2/cyberattack-1>",
            "struc": "<https://www.tno.nl/defense/ontology/c2/energy-system-Lithuania>",
            "datetime": "\"2024-12-25T09:00:00\"^^xsd:dateTime"
          },
          {
            "att": "<https://www.tno.nl/defense/data/c2/cyberattack-2>",
            "struc": "<https://www.tno.nl/defense/ontology/c2/energy-system-Latvia>",
            "datetime": "\"2024-12-25T09:00:00\"^^xsd:dateTime"
          },
          {
            "att": "<https://www.tno.nl/defense/data/c2/cyberattack-3>",
            "struc": "<https://www.tno.nl/defense/ontology/c2/gas-provider-Lithuania>",
            "datetime": "\"2024-12-25T09:00:00\"^^xsd:dateTime"
          }
        ]
  kb2:
    build: ./answering_kb
    environment:
      KE_URL: http://runtime-1:8280/rest
      KB_ID: http://example.org/kb2
      PREFIXES: |
        {
          "rdf": "http://www.w3.org/1999/02/22-rdf-syntax-ns#",
          "c2": "https://www.tno.nl/defense/ontology/c2/"
        }
      GRAPH_PATTERN: |
        ?struc rdf:type c2:Structure .
        ?struc c2:hasName ?name .
        ?struc c2:isLocatedAt ?area .
      KB_DATA: |
        [
          {
            "struc": "<https://www.tno.nl/defense/ontology/c2/energy-system-Lithuania>",
            "name": "\"Energy-system-Lithuania\"^^xsd:string",
            "area": "<https://www.tno.nl/defense/ontology/c2/LithuaniaCountry>"
          },
          {
            "struc": "<https://www.tno.nl/defense/ontology/c2/energy-system-Latvia>",
            "name": "\"Energy-system-Latvia\"^^xsd:string",
            "area": "<https://www.tno.nl/defense/ontology/c2/LatviaCountry>"
          }
        ]
  kb3:
    build: ./answering_kb
    environment:
      KE_URL: http://runtime-1:8280/rest
      KB_ID: http://example.org/kb3
      PREFIXES: |
        {
          "rdf": "http://www.w3.org/1999/02/22-rdf-syntax-ns#",
          "c2": "https://www.tno.nl/defense/ontology/c2/"
        }
      GRAPH_PATTERN: |
        ?area rdf:type c2:Area .
        ?area c2:hasName ?name . 
      KB_DATA: |
        [
          {
            "area": "<https://www.tno.nl/defense/ontology/c2/LithuaniaCountry>",
            "name": "\"Lithuania\"^^xsd:string"
          },
          {
            "area": "<https://www.tno.nl/defense/ontology/c2/LatviaCountry>",
            "name": "\"Latvia\"^^xsd:string"
          }
        ]
  answer-kb:
    build: ./answering_kb
    environment:
      KE_URL: http://host.docker.internal:8280/rest
      KB_ID: http://example.org/an-answer-knowledge-base-id
      PREFIXES: |
        {
          "ex": "http://example.org/"
        }
      GRAPH_PATTERN: |
        ?a ex:isRelatedTo ?b .
      KB_DATA: |
        [
          {
            "a": "<http://example.org/Barry>",
            "b": "<http://example.org/Jack>"
          }
        ]
  react-kb:
    build: ./react_kb
    environment:
      KE_URL: http://host.docker.internal:8280/rest
      KB_ID: http://example.org/a-react-knowledge-base-id
      PREFIXES: |
        {
          "ex": "http://example.org/"
        }
      ARGUMENT_GRAPH_PATTERN: |
        ?a ex:liveInTheSameHouse ?b .
      RESULT_GRAPH_PATTERN: |
        ?a ex:isRelatedTo ?b .
      KB_DATA: |
        [
          {
            "a": "<http://example.org/Celine>",
            "b": "<http://example.org/Jack>"
          }
        ]
